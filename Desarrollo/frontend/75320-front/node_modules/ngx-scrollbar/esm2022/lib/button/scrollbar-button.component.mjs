import { Component, effect, untracked, input, ChangeDetectionStrategy } from '@angular/core';
import { tap, delay, merge, switchMap, fromEvent, takeUntil, interval, takeWhile, animationFrameScheduler } from 'rxjs';
import { enableSelection, preventSelection, stopPropagation } from '../utils/common';
import { PointerEventsAdapter } from '../utils/pointer-events-adapter';
import * as i0 from "@angular/core";
// canScroll function can work for y-axis and x-axis for both LTR and RTL directions
const canScrollFunc = {
    forward: (scrollOffset, scrollMax) => scrollOffset < scrollMax,
    backward: (scrollOffset) => scrollOffset > 0
};
const scrollStepFunc = {
    forward: (scrollBy, offset) => offset + scrollBy,
    backward: (scrollBy, offset) => offset - scrollBy
};
const horizontalScrollStepFunc = {
    rtl: {
        forward: (scrollBy, offset, scrollMax) => scrollMax - offset - scrollBy,
        backward: (scrollBy, offset, scrollMax) => scrollMax - offset + scrollBy
    },
    ltr: scrollStepFunc
};
export class ScrollbarButton extends PointerEventsAdapter {
    get pointerEvents() {
        const pointerDown$ = fromEvent(this.nativeElement, 'pointerdown').pipe(stopPropagation(), preventSelection(this.document));
        const pointerUp$ = fromEvent(this.document, 'pointerup', { passive: true }).pipe(enableSelection(this.document));
        const pointerLeave$ = fromEvent(this.nativeElement, 'pointerleave', { passive: true });
        // Combine pointerup and pointerleave events into one stream
        const pointerUpOrLeave$ = merge(pointerUp$, pointerLeave$);
        return pointerDown$.pipe(switchMap(() => this.firstScrollStep().pipe(delay(this.afterFirstClickDelay), switchMap(() => this.onOngoingPointerdown()), takeUntil(pointerUpOrLeave$))));
    }
    constructor() {
        effect(() => {
            const scrollDirection = this.scrollDirection();
            const dir = this.cmp.direction();
            untracked(() => {
                // Get the canScroll function according to scroll direction (forward/backward)
                this.canScroll = canScrollFunc[scrollDirection];
                if (this.control.axis === 'x') {
                    // Get the nextStep function according to scroll direction (forward/backward) and layout direction (LTR/RTL)
                    this.nextStep = horizontalScrollStepFunc[dir][scrollDirection];
                }
                else {
                    // Get the nextStep function according to scroll direction (forward/backward)
                    this.nextStep = scrollStepFunc[scrollDirection];
                }
            });
        });
        super();
        this.scrollbarButton = input.required();
        this.scrollDirection = input.required();
        this.afterFirstClickDelay = 120;
        this.firstClickDuration = 100;
        this.scrollBy = 50;
        this.onGoingScrollBy = 12;
    }
    firstScrollStep() {
        const value = this.nextStep(this.scrollBy, this.control.viewportScrollOffset, this.control.viewportScrollMax);
        return this.control.scrollTo(value, this.firstClickDuration);
    }
    onGoingScrollStep() {
        const scrollMax = this.control.viewportScrollMax;
        const value = this.nextStep(this.onGoingScrollBy, this.control.viewportScrollOffset, scrollMax);
        this.control.instantScrollTo(value, scrollMax);
    }
    onOngoingPointerdown() {
        return interval(0, animationFrameScheduler).pipe(takeWhile(() => this.canScroll(this.control.viewportScrollOffset, this.control.viewportScrollMax)), tap(() => this.onGoingScrollStep()));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.11", ngImport: i0, type: ScrollbarButton, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.1.0", version: "18.2.11", type: ScrollbarButton, isStandalone: true, selector: "button[scrollbarButton]", inputs: { scrollbarButton: { classPropertyName: "scrollbarButton", publicName: "scrollbarButton", isSignal: true, isRequired: true, transformFunction: null }, scrollDirection: { classPropertyName: "scrollDirection", publicName: "scrollDirection", isSignal: true, isRequired: true, transformFunction: null } }, usesInheritance: true, ngImport: i0, template: "<div class=\"ng-scrollbar-button-icon\">\r\n  <svg viewBox=\"0 0 512 512\"\r\n       xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path\r\n      d=\"M413.1,327.3l-1.8-2.1l-136-156.5c-4.6-5.3-11.5-8.6-19.2-8.6c-7.7,0-14.6,3.4-19.2,8.6L101,324.9l-2.3,2.6  C97,330,96,333,96,336.2c0,8.7,7.4,15.8,16.6,15.8v0h286.8v0c9.2,0,16.6-7.1,16.6-15.8C416,332.9,414.9,329.8,413.1,327.3z\"/>\r\n  </svg>\r\n</div>\r\n", styles: [":host{--scrollbar-button-size: 20px;position:relative;border:none;margin:0;padding:0;border-radius:0;appearance:none;background-color:var(--INTERNAL-scrollbar-button-color)}:host svg{width:100%;height:100%;fill:var(--INTERNAL-scrollbar-button-fill)}:host:hover{background:var(--INTERNAL-scrollbar-button-hover-color)}:host:hover svg{fill:var(--INTERNAL-scrollbar-button-hover-fill)}:host:active{background:var(--INTERNAL-scrollbar-button-active-color)}:host:active svg{fill:var(--INTERNAL-scrollbar-button-active-fill)}:host[scrollbarButton=top],:host[scrollbarButton=start]{order:1}:host[scrollbarButton=bottom],:host[scrollbarButton=end]{order:3}:host[scrollbarButton=top],:host[scrollbarButton=bottom]{width:100%;height:var(--scrollbar-button-size)}:host[scrollbarButton=start],:host[scrollbarButton=end]{width:var(--scrollbar-button-size);height:100%}:host[scrollbarButton=bottom]{--_button-rotate: 180deg}:host[scrollbarButton=start]{--_button-rotate: -90deg}:host[scrollbarButton=start] .ng-scrollbar-button-icon{writing-mode:vertical-lr}:host[scrollbarButton=end]{--_button-rotate: 90deg}:host[scrollbarButton=end] .ng-scrollbar-button-icon{writing-mode:vertical-rl}.ng-scrollbar-button-icon{rotate:var(--_button-rotate);display:flex;place-content:center;place-items:center;width:100%;height:100%}\n"], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.11", ngImport: i0, type: ScrollbarButton, decorators: [{
            type: Component,
            args: [{ standalone: true, selector: 'button[scrollbarButton]', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div class=\"ng-scrollbar-button-icon\">\r\n  <svg viewBox=\"0 0 512 512\"\r\n       xmlns=\"http://www.w3.org/2000/svg\">\r\n    <path\r\n      d=\"M413.1,327.3l-1.8-2.1l-136-156.5c-4.6-5.3-11.5-8.6-19.2-8.6c-7.7,0-14.6,3.4-19.2,8.6L101,324.9l-2.3,2.6  C97,330,96,333,96,336.2c0,8.7,7.4,15.8,16.6,15.8v0h286.8v0c9.2,0,16.6-7.1,16.6-15.8C416,332.9,414.9,329.8,413.1,327.3z\"/>\r\n  </svg>\r\n</div>\r\n", styles: [":host{--scrollbar-button-size: 20px;position:relative;border:none;margin:0;padding:0;border-radius:0;appearance:none;background-color:var(--INTERNAL-scrollbar-button-color)}:host svg{width:100%;height:100%;fill:var(--INTERNAL-scrollbar-button-fill)}:host:hover{background:var(--INTERNAL-scrollbar-button-hover-color)}:host:hover svg{fill:var(--INTERNAL-scrollbar-button-hover-fill)}:host:active{background:var(--INTERNAL-scrollbar-button-active-color)}:host:active svg{fill:var(--INTERNAL-scrollbar-button-active-fill)}:host[scrollbarButton=top],:host[scrollbarButton=start]{order:1}:host[scrollbarButton=bottom],:host[scrollbarButton=end]{order:3}:host[scrollbarButton=top],:host[scrollbarButton=bottom]{width:100%;height:var(--scrollbar-button-size)}:host[scrollbarButton=start],:host[scrollbarButton=end]{width:var(--scrollbar-button-size);height:100%}:host[scrollbarButton=bottom]{--_button-rotate: 180deg}:host[scrollbarButton=start]{--_button-rotate: -90deg}:host[scrollbarButton=start] .ng-scrollbar-button-icon{writing-mode:vertical-lr}:host[scrollbarButton=end]{--_button-rotate: 90deg}:host[scrollbarButton=end] .ng-scrollbar-button-icon{writing-mode:vertical-rl}.ng-scrollbar-button-icon{rotate:var(--_button-rotate);display:flex;place-content:center;place-items:center;width:100%;height:100%}\n"] }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsYmFyLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc2Nyb2xsYmFyL3NyYy9saWIvYnV0dG9uL3Njcm9sbGJhci1idXR0b24uY29tcG9uZW50LnRzIiwiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXNjcm9sbGJhci9zcmMvbGliL2J1dHRvbi9zY3JvbGxiYXItYnV0dG9uLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQWUsdUJBQXVCLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFMUcsT0FBTyxFQUVMLEdBQUcsRUFDSCxLQUFLLEVBQ0wsS0FBSyxFQUNMLFNBQVMsRUFDVCxTQUFTLEVBQ1QsU0FBUyxFQUNULFFBQVEsRUFDUixTQUFTLEVBQ1QsdUJBQXVCLEVBQ3hCLE1BQU0sTUFBTSxDQUFDO0FBQ2QsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNyRixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7QUFNdkUsb0ZBQW9GO0FBQ3BGLE1BQU0sYUFBYSxHQUFnRDtJQUNqRSxPQUFPLEVBQUUsQ0FBQyxZQUFvQixFQUFFLFNBQWlCLEVBQVcsRUFBRSxDQUFDLFlBQVksR0FBRyxTQUFTO0lBQ3ZGLFFBQVEsRUFBRSxDQUFDLFlBQW9CLEVBQVcsRUFBRSxDQUFDLFlBQVksR0FBRyxDQUFDO0NBQzlELENBQUE7QUFFRCxNQUFNLGNBQWMsR0FBaUQ7SUFDbkUsT0FBTyxFQUFFLENBQUMsUUFBZ0IsRUFBRSxNQUFjLEVBQUUsRUFBRSxDQUFDLE1BQU0sR0FBRyxRQUFRO0lBQ2hFLFFBQVEsRUFBRSxDQUFDLFFBQWdCLEVBQUUsTUFBYyxFQUFFLEVBQUUsQ0FB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QUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUN0SCxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRU8saUJBQWlCO1FBQ3ZCLE1BQU0sU0FBUyxHQUFXLElBQUksQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUM7UUFDekQsTUFBTSxLQUFLLEdBQVcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsb0JBQW9CLEVBQUUsU0FBUyxDQUFDLENBQUM7UUFDeEcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFTyxvQkFBb0I7UUFDMUIsT0FBTyxRQUFRLENBQUMsQ0FBQyxFQUFFLHVCQUF1QixDQUFDLENBQUMsSUFBSSxDQUM5QyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLG9CQUFvQixFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxFQUNsRyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FDUixDQUFDO0lBQ2hDLENBQUM7K0dBekVVLGVBQWU7bUdBQWYsZUFBZSxnYUMvQzVCLG9aQU9BOzs0RkR3Q2EsZUFBZTtrQkFQM0IsU0FBUztpQ0FDSSxJQUFJLFlBQ04seUJBQXlCLG1CQUdsQix1QkFBdUIsQ0FBQyxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBlZmZlY3QsIHVudHJhY2tlZCwgaW5wdXQsIElucHV0U2lnbmFsLCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBEaXJlY3Rpb24gfSBmcm9tICdAYW5ndWxhci9jZGsvYmlkaSc7XHJcbmltcG9ydCB7XHJcbiAgT2JzZXJ2YWJsZSxcclxuICB0YXAsXHJcbiAgZGVsYXksXHJcbiAgbWVyZ2UsXHJcbiAgc3dpdGNoTWFwLFxyXG4gIGZyb21FdmVudCxcclxuICB0YWtlVW50aWwsXHJcbiAgaW50ZXJ2YWwsXHJcbiAgdGFrZVdoaWxlLFxyXG4gIGFuaW1hdGlvbkZyYW1lU2NoZWR1bGVyXHJcbn0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGVuYWJsZVNlbGVjdGlvbiwgcHJldmVudFNlbGVjdGlvbiwgc3RvcFByb3BhZ2F0aW9uIH0gZnJvbSAnLi4vdXRpbHMvY29tbW9uJztcclxuaW1wb3J0IHsgUG9pbnRlckV2ZW50c0FkYXB0ZXIgfSBmcm9tICcuLi91dGlscy9wb2ludGVyLWV2ZW50cy1hZGFwdGVyJztcclxuXHJcbnR5cGUgQ2FuU2Nyb2xsRm4gPSAob2Zmc2V0OiBudW1iZXIsIHNjcm9sbE1heD86IG51bWJlcikgPT4gYm9vbGVhbjtcclxuXHJcbnR5cGUgU2Nyb2xsU3RlcEZuID0gKHNjcm9sbEJ5OiBudW1iZXIsIG9mZnNldDogbnVtYmVyLCBzY3JvbGxNYXg6IG51bWJlcikgPT4gbnVtYmVyO1xyXG5cclxuLy8gY2FuU2Nyb2xsIGZ1bmN0aW9uIGNhbiB3b3JrIGZvciB5LWF4aXMgYW5kIHgtYXhpcyBmb3IgYm90aCBMVFIgYW5kIFJUTCBkaXJlY3Rpb25zXHJcbmNvbnN0IGNhblNjcm9sbEZ1bmM6IFJlY29yZDwnZm9yd2FyZCcgfCAnYmFja3dhcmQnLCBDYW5TY3JvbGxGbj4gPSB7XHJcbiAgZm9yd2FyZDogKHNjcm9sbE9mZnNldDogbnVtYmVyLCBzY3JvbGxNYXg6IG51bWJlcik6IGJvb2xlYW4gPT4gc2Nyb2xsT2Zmc2V0IDwgc2Nyb2xsTWF4LFxyXG4gIGJhY2t3YXJkOiAoc2Nyb2xsT2Zmc2V0OiBudW1iZXIpOiBib29sZWFuID0+IHNjcm9sbE9mZnNldCA+IDBcclxufVxyXG5cclxuY29uc3Qgc2Nyb2xsU3RlcEZ1bmM6IFJlY29yZDwnZm9yd2FyZCcgfCAnYmFja3dhcmQnLCBTY3JvbGxTdGVwRm4+ID0ge1xyXG4gIGZvcndhcmQ6IChzY3JvbGxCeTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcikgPT4gb2Zmc2V0ICsgc2Nyb2xsQnksXHJcbiAgYmFja3dhcmQ6IChzY3JvbGxCeTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlcikgPT4gb2Zmc2V0IC0gc2Nyb2xsQnlcclxufTtcclxuXHJcbmNvbnN0IGhvcml6b250YWxTY3JvbGxTdGVwRnVuYzogUmVjb3JkPCdsdHInIHwgJ3J0bCcsIFJlY29yZDwnZm9yd2FyZCcgfCAnYmFja3dhcmQnLCBTY3JvbGxTdGVwRm4+PiA9IHtcclxuICBydGw6IHtcclxuICAgIGZvcndhcmQ6IChzY3JvbGxCeTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlciwgc2Nyb2xsTWF4OiBudW1iZXIpID0+IHNjcm9sbE1heCAtIG9mZnNldCAtIHNjcm9sbEJ5LFxyXG4gICAgYmFja3dhcmQ6IChzY3JvbGxCeTogbnVtYmVyLCBvZmZzZXQ6IG51bWJlciwgc2Nyb2xsTWF4OiBudW1iZXIpID0+IHNjcm9sbE1heCAtIG9mZnNldCArIHNjcm9sbEJ5XHJcbiAgfSxcclxuICBsdHI6IHNjcm9sbFN0ZXBGdW5jXHJcbn1cclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHN0YW5kYWxvbmU6IHRydWUsXHJcbiAgc2VsZWN0b3I6ICdidXR0b25bc2Nyb2xsYmFyQnV0dG9uXScsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3Njcm9sbGJhci1idXR0b24uY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsOiAnLi9zY3JvbGxiYXItYnV0dG9uLmNvbXBvbmVudC5zY3NzJyxcclxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxyXG59KVxyXG5leHBvcnQgY2xhc3MgU2Nyb2xsYmFyQnV0dG9uIGV4dGVuZHMgUG9pbnRlckV2ZW50c0FkYXB0ZXIge1xyXG5cclxuICBzY3JvbGxiYXJCdXR0b246IElucHV0U2lnbmFsPCd0b3AnIHwgJ2JvdHRvbScgfCAnc3RhcnQnIHwgJ2VuZCc+ID0gaW5wdXQucmVxdWlyZWQoKTtcclxuICBzY3JvbGxEaXJlY3Rpb246IElucHV0U2lnbmFsPCdmb3J3YXJkJyB8ICdiYWNrd2FyZCc+ID0gaW5wdXQucmVxdWlyZWQoKTtcclxuXHJcbiAgcHJpdmF0ZSBhZnRlckZpcnN0Q2xpY2tEZWxheTogbnVtYmVyID0gMTIwO1xyXG4gIHByaXZhdGUgZmlyc3RDbGlja0R1cmF0aW9uOiBudW1iZXIgPSAxMDA7XHJcbiAgcHJpdmF0ZSBzY3JvbGxCeTogbnVtYmVyID0gNTA7XHJcbiAgcHJpdmF0ZSBvbkdvaW5nU2Nyb2xsQnk6IG51bWJlciA9IDEyO1xyXG5cclxuICBwcml2YXRlIG5leHRTdGVwOiAoc2Nyb2xsQnk6IG51bWJlciwgb2Zmc2V0OiBudW1iZXIsIHNjcm9sbE1heDogbnVtYmVyKSA9PiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBjYW5TY3JvbGw6IChvZmZzZXQ6IG51bWJlciwgc2Nyb2xsTWF4OiBudW1iZXIpID0+IGJvb2xlYW47XHJcblxyXG4gIGdldCBwb2ludGVyRXZlbnRzKCk6IE9ic2VydmFibGU8UG9pbnRlckV2ZW50PiB7XHJcbiAgICBjb25zdCBwb2ludGVyRG93biQ6IE9ic2VydmFibGU8UG9pbnRlckV2ZW50PiA9IGZyb21FdmVudDxQb2ludGVyRXZlbnQ+KHRoaXMubmF0aXZlRWxlbWVudCwgJ3BvaW50ZXJkb3duJykucGlwZShcclxuICAgICAgc3RvcFByb3BhZ2F0aW9uKCksXHJcbiAgICAgIHByZXZlbnRTZWxlY3Rpb24odGhpcy5kb2N1bWVudClcclxuICAgICk7XHJcbiAgICBjb25zdCBwb2ludGVyVXAkOiBPYnNlcnZhYmxlPFBvaW50ZXJFdmVudD4gPSBmcm9tRXZlbnQ8UG9pbnRlckV2ZW50Pih0aGlzLmRvY3VtZW50LCAncG9pbnRlcnVwJywgeyBwYXNzaXZlOiB0cnVlIH0pLnBpcGUoXHJcbiAgICAgIGVuYWJsZVNlbGVjdGlvbih0aGlzLmRvY3VtZW50KVxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBwb2ludGVyTGVhdmUkOiBPYnNlcnZhYmxlPFBvaW50ZXJFdmVudD4gPSBmcm9tRXZlbnQ8UG9pbnRlckV2ZW50Pih0aGlzLm5hdGl2ZUVsZW1lbnQsICdwb2ludGVybGVhdmUnLCB7IHBhc3NpdmU6IHRydWUgfSk7XHJcblxyXG4gICAgLy8gQ29tYmluZSBwb2ludGVydXAgYW5kIHBvaW50ZXJsZWF2ZSBldmVudHMgaW50byBvbmUgc3RyZWFtXHJcbiAgICBjb25zdCBwb2ludGVyVXBPckxlYXZlJDogT2JzZXJ2YWJsZTxQb2ludGVyRXZlbnQ+ID0gbWVyZ2UocG9pbnRlclVwJCwgcG9pbnRlckxlYXZlJCk7XHJcblxyXG4gICAgcmV0dXJuIHBvaW50ZXJEb3duJC5waXBlKFxyXG4gICAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5maXJzdFNjcm9sbFN0ZXAoKS5waXBlKFxyXG4gICAgICAgIGRlbGF5KHRoaXMuYWZ0ZXJGaXJzdENsaWNrRGVsYXkpLFxyXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLm9uT25nb2luZ1BvaW50ZXJkb3duKCkpLFxyXG4gICAgICAgIHRha2VVbnRpbChwb2ludGVyVXBPckxlYXZlJCksXHJcbiAgICAgICkpXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBlZmZlY3QoKCkgPT4ge1xyXG4gICAgICBjb25zdCBzY3JvbGxEaXJlY3Rpb246ICdmb3J3YXJkJyB8ICdiYWNrd2FyZCcgPSB0aGlzLnNjcm9sbERpcmVjdGlvbigpO1xyXG4gICAgICBjb25zdCBkaXI6IERpcmVjdGlvbiA9IHRoaXMuY21wLmRpcmVjdGlvbigpO1xyXG5cclxuICAgICAgdW50cmFja2VkKCgpID0+IHtcclxuICAgICAgICAvLyBHZXQgdGhlIGNhblNjcm9sbCBmdW5jdGlvbiBhY2NvcmRpbmcgdG8gc2Nyb2xsIGRpcmVjdGlvbiAoZm9yd2FyZC9iYWNrd2FyZClcclxuICAgICAgICB0aGlzLmNhblNjcm9sbCA9IGNhblNjcm9sbEZ1bmNbc2Nyb2xsRGlyZWN0aW9uXTtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMuY29udHJvbC5heGlzID09PSAneCcpIHtcclxuICAgICAgICAgIC8vIEdldCB0aGUgbmV4dFN0ZXAgZnVuY3Rpb24gYWNjb3JkaW5nIHRvIHNjcm9sbCBkaXJlY3Rpb24gKGZvcndhcmQvYmFja3dhcmQpIGFuZCBsYXlvdXQgZGlyZWN0aW9uIChMVFIvUlRMKVxyXG4gICAgICAgICAgdGhpcy5uZXh0U3RlcCA9IGhvcml6b250YWxTY3JvbGxTdGVwRnVuY1tkaXJdW3Njcm9sbERpcmVjdGlvbl07XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIC8vIEdldCB0aGUgbmV4dFN0ZXAgZnVuY3Rpb24gYWNjb3JkaW5nIHRvIHNjcm9sbCBkaXJlY3Rpb24gKGZvcndhcmQvYmFja3dhcmQpXHJcbiAgICAgICAgICB0aGlzLm5leHRTdGVwID0gc2Nyb2xsU3RlcEZ1bmNbc2Nyb2xsRGlyZWN0aW9uXTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBzdXBlcigpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmaXJzdFNjcm9sbFN0ZXAoKTogT2JzZXJ2YWJsZTx2b2lkPiB7XHJcbiAgICBjb25zdCB2YWx1ZTogbnVtYmVyID0gdGhpcy5uZXh0U3RlcCh0aGlzLnNjcm9sbEJ5LCB0aGlzLmNvbnRyb2wudmlld3BvcnRTY3JvbGxPZmZzZXQsIHRoaXMuY29udHJvbC52aWV3cG9ydFNjcm9sbE1heCk7XHJcbiAgICByZXR1cm4gdGhpcy5jb250cm9sLnNjcm9sbFRvKHZhbHVlLCB0aGlzLmZpcnN0Q2xpY2tEdXJhdGlvbik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9uR29pbmdTY3JvbGxTdGVwKCk6IHZvaWQge1xyXG4gICAgY29uc3Qgc2Nyb2xsTWF4OiBudW1iZXIgPSB0aGlzLmNvbnRyb2wudmlld3BvcnRTY3JvbGxNYXg7XHJcbiAgICBjb25zdCB2YWx1ZTogbnVtYmVyID0gdGhpcy5uZXh0U3RlcCh0aGlzLm9uR29pbmdTY3JvbGxCeSwgdGhpcy5jb250cm9sLnZpZXdwb3J0U2Nyb2xsT2Zmc2V0LCBzY3JvbGxNYXgpO1xyXG4gICAgdGhpcy5jb250cm9sLmluc3RhbnRTY3JvbGxUbyh2YWx1ZSwgc2Nyb2xsTWF4KTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb25PbmdvaW5nUG9pbnRlcmRvd24oKTogT2JzZXJ2YWJsZTxQb2ludGVyRXZlbnQ+IHtcclxuICAgIHJldHVybiBpbnRlcnZhbCgwLCBhbmltYXRpb25GcmFtZVNjaGVkdWxlcikucGlwZShcclxuICAgICAgdGFrZVdoaWxlKCgpID0+IHRoaXMuY2FuU2Nyb2xsKHRoaXMuY29udHJvbC52aWV3cG9ydFNjcm9sbE9mZnNldCwgdGhpcy5jb250cm9sLnZpZXdwb3J0U2Nyb2xsTWF4KSksXHJcbiAgICAgIHRhcCgoKSA9PiB0aGlzLm9uR29pbmdTY3JvbGxTdGVwKCkpXHJcbiAgICApIGFzIE9ic2VydmFibGU8UG9pbnRlckV2ZW50PjtcclxuICB9XHJcbn1cclxuIiwiPGRpdiBjbGFzcz1cIm5nLXNjcm9sbGJhci1idXR0b24taWNvblwiPlxyXG4gIDxzdmcgdmlld0JveD1cIjAgMCA1MTIgNTEyXCJcclxuICAgICAgIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIj5cclxuICAgIDxwYXRoXHJcbiAgICAgIGQ9XCJNNDEzLjEsMzI3LjNsLTEuOC0yLjFsLTEzNi0xNTYuNWMtNC42LTUuMy0xMS41LTguNi0xOS4yLTguNmMtNy43LDAtMTQuNiwzLjQtMTkuMiw4LjZMMTAxLDMyNC45bC0yLjMsMi42ICBDOTcsMzMwLDk2LDMzMyw5NiwzMzYuMmMwLDguNyw3LjQsMTUuOCwxNi42LDE1Ljh2MGgyODYuOHYwYzkuMiwwLDE2LjYtNy4xLDE2LjYtMTUuOEM0MTYsMzMyLjksNDE0LjksMzI5LjgsNDEzLjEsMzI3LjN6XCIvPlxyXG4gIDwvc3ZnPlxyXG48L2Rpdj5cclxuIl19