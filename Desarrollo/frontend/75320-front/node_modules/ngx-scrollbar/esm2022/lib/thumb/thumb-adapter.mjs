import { Directive, inject, effect, untracked } from '@angular/core';
import { of, fromEvent, map, takeUntil, tap, switchMap } from 'rxjs';
import { stopPropagation, enableSelection, preventSelection } from '../utils/common';
import { ScrollbarManager } from '../utils/scrollbar-manager';
import { TrackAdapter } from '../track/track-adapter';
import { PointerEventsAdapter } from '../utils/pointer-events-adapter';
import * as i0 from "@angular/core";
export class ThumbAdapter extends PointerEventsAdapter {
    // Returns thumb size
    get size() {
        return this.nativeElement.getBoundingClientRect()[this.control.rectSizeProperty];
    }
    // The maximum space available for scrolling.
    get trackMax() {
        return this.track.size - this.size;
    }
    /**
     * Stream that emits the 'scrollTo' position when a scrollbar thumb element is dragged
     * This function is called by thumb drag event using viewport or scrollbar pointer events
     */
    get pointerEvents() {
        return fromEvent(this.nativeElement, 'pointerdown').pipe(stopPropagation(), preventSelection(this.document), switchMap((e) => {
            let startTrackMax;
            let startScrollMax;
            const dragStart = of(e).pipe(tap(() => {
                // Capture scrollMax and trackMax once
                startTrackMax = this.trackMax;
                startScrollMax = this.control.viewportScrollMax;
                this.setDragging(this.control.axis);
            }));
            const dragging = fromEvent(this.document, 'pointermove').pipe(stopPropagation());
            const dragEnd = fromEvent(this.document, 'pointerup', { capture: true }).pipe(stopPropagation(), enableSelection(this.document), tap(() => this.setDragging('none')));
            return dragStart.pipe(map((startEvent) => startEvent[this.control.offsetProperty]), switchMap((startOffset) => dragging.pipe(map((moveEvent) => moveEvent[this.control.clientProperty]), 
            // Calculate how far the pointer is from the top/left of the scrollbar (minus the dragOffset).
            map((moveClient) => moveClient - this.track.offset), map((trackRelativeOffset) => startScrollMax * (trackRelativeOffset - startOffset) / startTrackMax), tap((scrollPosition) => this.control.instantScrollTo(scrollPosition, startScrollMax)), takeUntil(dragEnd))));
        }));
    }
    constructor() {
        effect(() => {
            const script = this.manager.scrollTimelinePolyfill();
            untracked(() => {
                if (script && !this._animation) {
                    this._animation = startPolyfill(script, this.nativeElement, this.cmp.viewport.nativeElement, this.control.axis);
                }
            });
        });
        super();
        this.manager = inject(ScrollbarManager);
        this.track = inject(TrackAdapter);
    }
    setDragging(value) {
        this.zone.run(() => this.cmp.dragging.set(value));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.11", ngImport: i0, type: ThumbAdapter, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "18.2.11", type: ThumbAdapter, usesInheritance: true, ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.11", ngImport: i0, type: ThumbAdapter, decorators: [{
            type: Directive
        }], ctorParameters: () => [] });
function startPolyfill(ScrollTimeline, element, source, axis) {
    return element.animate({
        translate: [
            'var(--_scrollbar-thumb-transform-from)',
            'var(--_scrollbar-thumb-transform-to)'
        ]
    }, {
        fill: 'both',
        easing: 'linear',
        timeline: new ScrollTimeline({ source, axis })
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGh1bWItYWRhcHRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL25neC1zY3JvbGxiYXIvc3JjL2xpYi90aHVtYi90aHVtYi1hZGFwdGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDckUsT0FBTyxFQUFjLEVBQUUsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ2pGLE9BQU8sRUFHTCxlQUFlLEVBQ2YsZUFBZSxFQUNmLGdCQUFnQixFQUNqQixNQUFNLGlCQUFpQixDQUFDO0FBQ3pCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzlELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxpQ0FBaUMsQ0FBQzs7QUFHdkUsTUFBTSxPQUFnQixZQUFhLFNBQVEsb0JBQW9CO0lBUzdELHFCQUFxQjtJQUNyQixJQUFJLElBQUk7UUFDTixPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDbkYsQ0FBQztJQUVELDZDQUE2QztJQUM3QyxJQUFJLFFBQVE7UUFDVixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDckMsQ0FBQztJQUVEOzs7T0FHRztJQUNILElBQUksYUFBYTtRQUNmLE9BQU8sU0FBUyxDQUFlLElBQUksQ0FBQyxhQUFhLEVBQUUsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUNwRSxlQUFlLEVBQUUsRUFDakIsZ0JBQWdCLENBQUMs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QUFXLENBQUMsS0FBd0I7UUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDcEQsQ0FBQzsrR0E3RW1CLFlBQVk7bUdBQVosWUFBWTs7NEZBQVosWUFBWTtrQkFEakMsU0FBUzs7QUFpRlYsU0FBUyxhQUFhLENBQUMsY0FBa0MsRUFBRSxPQUFvQixFQUFFLE1BQW1CLEVBQUUsSUFBZTtJQUNuSCxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQ3BCO1FBQ0UsU0FBUyxFQUFFO1lBQ1Qsd0NBQXdDO1lBQ3hDLHNDQUFzQztTQUN2QztLQUNGLEVBQ0Q7UUFDRSxJQUFJLEVBQUUsTUFBTTtRQUNaLE1BQU0sRUFBRSxRQUFRO1FBQ2hCLFFBQVEsRUFBRSxJQUFJLGNBQWMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztLQUMvQyxDQUNGLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGlyZWN0aXZlLCBpbmplY3QsIGVmZmVjdCwgdW50cmFja2VkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mLCBmcm9tRXZlbnQsIG1hcCwgdGFrZVVudGlsLCB0YXAsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQge1xyXG4gIFNjcm9sbGJhckRyYWdnaW5nLFxyXG4gIFNjcm9sbFRpbWVsaW5lRnVuYyxcclxuICBzdG9wUHJvcGFnYXRpb24sXHJcbiAgZW5hYmxlU2VsZWN0aW9uLFxyXG4gIHByZXZlbnRTZWxlY3Rpb25cclxufSBmcm9tICcuLi91dGlscy9jb21tb24nO1xyXG5pbXBvcnQgeyBTY3JvbGxiYXJNYW5hZ2VyIH0gZnJvbSAnLi4vdXRpbHMvc2Nyb2xsYmFyLW1hbmFnZXInO1xyXG5pbXBvcnQgeyBUcmFja0FkYXB0ZXIgfSBmcm9tICcuLi90cmFjay90cmFjay1hZGFwdGVyJztcclxuaW1wb3J0IHsgUG9pbnRlckV2ZW50c0FkYXB0ZXIgfSBmcm9tICcuLi91dGlscy9wb2ludGVyLWV2ZW50cy1hZGFwdGVyJztcclxuXHJcbkBEaXJlY3RpdmUoKVxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVGh1bWJBZGFwdGVyIGV4dGVuZHMgUG9pbnRlckV2ZW50c0FkYXB0ZXIge1xyXG5cclxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbWFuYWdlcjogU2Nyb2xsYmFyTWFuYWdlciA9IGluamVjdChTY3JvbGxiYXJNYW5hZ2VyKTtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSB0cmFjazogVHJhY2tBZGFwdGVyID0gaW5qZWN0KFRyYWNrQWRhcHRlcik7XHJcblxyXG4gIC8vIFRoZSBhbmltYXRpb24gcmVmZXJlbmNlIHVzZWQgZm9yIGVuYWJsaW5nIHRoZSBwb2x5ZmlsbCBvbiBTYWZhcmkgYW5kIEZpcmVmb3guXHJcbiAgX2FuaW1hdGlvbjogQW5pbWF0aW9uO1xyXG5cclxuICAvLyBSZXR1cm5zIHRodW1iIHNpemVcclxuICBnZXQgc2l6ZSgpOiBudW1iZXIge1xyXG4gICAgcmV0dXJuIHRoaXMubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKVt0aGlzLmNvbnRyb2wucmVjdFNpemVQcm9wZXJ0eV07XHJcbiAgfVxyXG5cclxuICAvLyBUaGUgbWF4aW11bSBzcGFjZSBhdmFpbGFibGUgZm9yIHNjcm9sbGluZy5cclxuICBnZXQgdHJhY2tNYXgoKTogbnVtYmVyIHtcclxuICAgIHJldHVybiB0aGlzLnRyYWNrLnNpemUgLSB0aGlzLnNpemU7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdHJlYW0gdGhhdCBlbWl0cyB0aGUgJ3Njcm9sbFRvJyBwb3NpdGlvbiB3aGVuIGEgc2Nyb2xsYmFyIHRodW1iIGVsZW1lbnQgaXMgZHJhZ2dlZFxyXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgY2FsbGVkIGJ5IHRodW1iIGRyYWcgZXZlbnQgdXNpbmcgdmlld3BvcnQgb3Igc2Nyb2xsYmFyIHBvaW50ZXIgZXZlbnRzXHJcbiAgICovXHJcbiAgZ2V0IHBvaW50ZXJFdmVudHMoKTogT2JzZXJ2YWJsZTxQb2ludGVyRXZlbnQ+IHtcclxuICAgIHJldHVybiBmcm9tRXZlbnQ8UG9pbnRlckV2ZW50Pih0aGlzLm5hdGl2ZUVsZW1lbnQsICdwb2ludGVyZG93bicpLnBpcGUoXHJcbiAgICAgIHN0b3BQcm9wYWdhdGlvbigpLFxyXG4gICAgICBwcmV2ZW50U2VsZWN0aW9uKHRoaXMuZG9jdW1lbnQpLFxyXG4gICAgICBzd2l0Y2hNYXAoKGU6IFBvaW50ZXJFdmVudCkgPT4ge1xyXG4gICAgICAgIGxldCBzdGFydFRyYWNrTWF4OiBudW1iZXI7XHJcbiAgICAgICAgbGV0IHN0YXJ0U2Nyb2xsTWF4OiBudW1iZXI7XHJcblxyXG4gICAgICAgIGNvbnN0IGRyYWdTdGFydDogT2JzZXJ2YWJsZTxQb2ludGVyRXZlbnQ+ID0gb2Y8UG9pbnRlckV2ZW50PihlKS5waXBlKFxyXG4gICAgICAgICAgdGFwKCgpID0+IHtcclxuICAgICAgICAgICAgLy8gQ2FwdHVyZSBzY3JvbGxNYXggYW5kIHRyYWNrTWF4IG9uY2VcclxuICAgICAgICAgICAgc3RhcnRUcmFja01heCA9IHRoaXMudHJhY2tNYXg7XHJcbiAgICAgICAgICAgIHN0YXJ0U2Nyb2xsTWF4ID0gdGhpcy5jb250cm9sLnZpZXdwb3J0U2Nyb2xsTWF4O1xyXG4gICAgICAgICAgICB0aGlzLnNldERyYWdnaW5nKHRoaXMuY29udHJvbC5heGlzKTtcclxuICAgICAgICAgIH0pLFxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIGNvbnN0IGRyYWdnaW5nOiBPYnNlcnZhYmxlPFBvaW50ZXJFdmVudD4gPSBmcm9tRXZlbnQ8UG9pbnRlckV2ZW50Pih0aGlzLmRvY3VtZW50LCAncG9pbnRlcm1vdmUnKS5waXBlKHN0b3BQcm9wYWdhdGlvbigpKTtcclxuXHJcbiAgICAgICAgY29uc3QgZHJhZ0VuZDogT2JzZXJ2YWJsZTxQb2ludGVyRXZlbnQ+ID0gZnJvbUV2ZW50PFBvaW50ZXJFdmVudD4odGhpcy5kb2N1bWVudCwgJ3BvaW50ZXJ1cCcsIHsgY2FwdHVyZTogdHJ1ZSB9KS5waXBlKFxyXG4gICAgICAgICAgc3RvcFByb3BhZ2F0aW9uKCksXHJcbiAgICAgICAgICBlbmFibGVTZWxlY3Rpb24odGhpcy5kb2N1bWVudCksXHJcbiAgICAgICAgICB0YXAoKCkgPT4gdGhpcy5zZXREcmFnZ2luZygnbm9uZScpKVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICAgIHJldHVybiBkcmFnU3RhcnQucGlwZShcclxuICAgICAgICAgIG1hcCgoc3RhcnRFdmVudDogUG9pbnRlckV2ZW50KSA9PiBzdGFydEV2ZW50W3RoaXMuY29udHJvbC5vZmZzZXRQcm9wZXJ0eV0pLFxyXG4gICAgICAgICAgc3dpdGNoTWFwKChzdGFydE9mZnNldDogbnVtYmVyKSA9PiBkcmFnZ2luZy5waXBlKFxyXG4gICAgICAgICAgICBtYXAoKG1vdmVFdmVudDogUG9pbnRlckV2ZW50KSA9PiBtb3ZlRXZlbnRbdGhpcy5jb250cm9sLmNsaWVudFByb3BlcnR5XSksXHJcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBob3cgZmFyIHRoZSBwb2ludGVyIGlzIGZyb20gdGhlIHRvcC9sZWZ0IG9mIHRoZSBzY3JvbGxiYXIgKG1pbnVzIHRoZSBkcmFnT2Zmc2V0KS5cclxuICAgICAgICAgICAgbWFwKChtb3ZlQ2xpZW50OiBudW1iZXIpID0+IG1vdmVDbGllbnQgLSB0aGlzLnRyYWNrLm9mZnNldCksXHJcbiAgICAgICAgICAgIG1hcCgodHJhY2tSZWxhdGl2ZU9mZnNldDogbnVtYmVyKSA9PiBzdGFydFNjcm9sbE1heCAqICh0cmFja1JlbGF0aXZlT2Zmc2V0IC0gc3RhcnRPZmZzZXQpIC8gc3RhcnRUcmFja01heCksXHJcbiAgICAgICAgICAgIHRhcCgoc2Nyb2xsUG9zaXRpb246IG51bWJlcikgPT4gdGhpcy5jb250cm9sLmluc3RhbnRTY3JvbGxUbyhzY3JvbGxQb3NpdGlvbiwgc3RhcnRTY3JvbGxNYXgpKSxcclxuICAgICAgICAgICAgdGFrZVVudGlsKGRyYWdFbmQpXHJcbiAgICAgICAgICApIGFzIE9ic2VydmFibGU8UG9pbnRlckV2ZW50PilcclxuICAgICAgICApO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgZWZmZWN0KCgpID0+IHtcclxuICAgICAgY29uc3Qgc2NyaXB0OiBTY3JvbGxUaW1lbGluZUZ1bmMgPSB0aGlzLm1hbmFnZXIuc2Nyb2xsVGltZWxpbmVQb2x5ZmlsbCgpO1xyXG4gICAgICB1bnRyYWNrZWQoKCkgPT4ge1xyXG4gICAgICAgIGlmIChzY3JpcHQgJiYgIXRoaXMuX2FuaW1hdGlvbikge1xyXG4gICAgICAgICAgdGhpcy5fYW5pbWF0aW9uID0gc3RhcnRQb2x5ZmlsbChzY3JpcHQsIHRoaXMubmF0aXZlRWxlbWVudCwgdGhpcy5jbXAudmlld3BvcnQubmF0aXZlRWxlbWVudCwgdGhpcy5jb250cm9sLmF4aXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0pO1xyXG4gICAgc3VwZXIoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc2V0RHJhZ2dpbmcodmFsdWU6IFNjcm9sbGJhckRyYWdnaW5nKTogdm9pZCB7XHJcbiAgICB0aGlzLnpvbmUucnVuKCgpID0+IHRoaXMuY21wLmRyYWdnaW5nLnNldCh2YWx1ZSkpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc3RhcnRQb2x5ZmlsbChTY3JvbGxUaW1lbGluZTogU2Nyb2xsVGltZWxpbmVGdW5jLCBlbGVtZW50OiBIVE1MRWxlbWVudCwgc291cmNlOiBIVE1MRWxlbWVudCwgYXhpczogJ3gnIHwgJ3knKTogQW5pbWF0aW9uIHtcclxuICByZXR1cm4gZWxlbWVudC5hbmltYXRlKFxyXG4gICAge1xyXG4gICAgICB0cmFuc2xhdGU6IFtcclxuICAgICAgICAndmFyKC0tX3Njcm9sbGJhci10aHVtYi10cmFuc2Zvcm0tZnJvbSknLFxyXG4gICAgICAgICd2YXIoLS1fc2Nyb2xsYmFyLXRodW1iLXRyYW5zZm9ybS10byknXHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGZpbGw6ICdib3RoJyxcclxuICAgICAgZWFzaW5nOiAnbGluZWFyJyxcclxuICAgICAgdGltZWxpbmU6IG5ldyBTY3JvbGxUaW1lbGluZSh7IHNvdXJjZSwgYXhpcyB9KVxyXG4gICAgfVxyXG4gICk7XHJcbn1cclxuIl19