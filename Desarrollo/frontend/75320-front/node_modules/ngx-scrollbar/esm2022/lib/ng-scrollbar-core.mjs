import { Directive, inject, signal, effect, output, computed, untracked, numberAttribute, booleanAttribute, input, NgZone, ElementRef, } from '@angular/core';
import { Platform } from '@angular/cdk/platform';
import { Directionality } from '@angular/cdk/bidi';
import { SharedResizeObserver } from '@angular/cdk/observers/private';
import { toSignal } from '@angular/core/rxjs-interop';
import { combineLatest } from 'rxjs';
import { SmoothScrollManager } from 'ngx-scrollbar/smooth-scroll';
import { NG_SCROLLBAR } from './utils/scrollbar-base';
import { ViewportAdapter } from './viewport';
import { getThrottledStream } from './utils/common';
import { NG_SCROLLBAR_OPTIONS, ScrollbarUpdateReason } from './ng-scrollbar.model';
import * as i0 from "@angular/core";
export class NgScrollbarCore {
    constructor() {
        /** Global options */
        this.options = inject(NG_SCROLLBAR_OPTIONS);
        this.sharedResizeObserver = inject(SharedResizeObserver);
        this.zone = inject(NgZone);
        this.platform = inject(Platform);
        /** A flag that indicates if the platform is mobile */
        this.isMobile = this.platform.IOS || this.platform.ANDROID;
        this.dir = inject(Directionality);
        this.smoothScroll = inject(SmoothScrollManager);
        /** Viewport adapter instance */
        this.viewport = inject(ViewportAdapter, { self: true });
        this.nativeElement = inject((ElementRef)).nativeElement;
        /**
         * Indicates if the direction is 'ltr' or 'rtl'
         */
        this.direction = toSignal(this.dir.change, { initialValue: this.dir.value });
        /**
         * Indicates when scrollbar thumb is being dragged
         */
        this.dragging = signal('none');
        /**
         * Sets the supported scroll track of the viewport, there are 3 options:
         *
         * - `vertical` Use both vertical and horizontal scrollbar
         * - `horizontal` Use both vertical and horizontal scrollbar
         * - `auto` Use both vertical and horizontal scrollbar
         */
        this.orientation = input(this.options.orientation);
        /**
         * When to show the scrollbar, and there are 3 options:
         *
         * - `native` (default) Scrollbar will be visible when viewport is scrollable like with native scrollbar
         * - `hover` Scrollbars are hidden by default, only visible on scrolling or hovering
         * - `always` Scrollbars are always shown even if the viewport is not scrollable
         */
        this.visibility = input(this.options.visibility);
        /** Show scrollbar buttons */
        this.buttons = input(this.options.buttons, {
            transform: booleanAttribute
        });
        /** Disables scrollbar interaction like dragging thumb and jumping by track click */
        this.disableInteraction = input(this.options.disableInteraction, {
            transform: booleanAttribute
        });
        /** Whether ResizeObserver is disabled */
        this.disableSensor = input(this.options.disableSensor, {
            transform: booleanAttribute
        });
        /** Throttle interval for detecting changes via ResizeObserver */
        this.sensorThrottleTime = input(this.options.sensorThrottleTime, {
            transform: numberAttribute
        });
        /** A flag used to activate hover effect on the offset area around the scrollbar */
        this.hoverOffset = input(this.options.hoverOffset, {
            transform: booleanAttribute
        });
        /** Viewport dimension */
        this.viewportDimension = signal({ width: 0, height: 0 });
        /** Content dimension */
        this.contentDimension = signal({ width: 0, height: 0 });
        this.state = computed(() => {
            let verticalUsed = false;
            let horizontalUsed = false;
            let isVerticallyScrollable = false;
            let isHorizontallyScrollable = false;
            const orientation = this.orientation();
            const visibility = this.visibility();
            const viewportDimensions = this.viewportDimension();
            const contentDimensions = this.contentDimension();
            // Check if vertical scrollbar should be displayed
            if (orientation === 'auto' || orientation === 'vertical') {
                isVerticallyScrollable = contentDimensions.height > viewportDimensions.height;
                verticalUsed = visibility === 'visible' || isVerticallyScrollable;
            }
            // Check if horizontal scrollbar should be displayed
            if (orientation === 'auto' || orientation === 'horizontal') {
                isHorizontallyScrollable = contentDimensions.width > viewportDimensions.width;
                horizontalUsed = visibility === 'visible' || isHorizontallyScrollable;
            }
            return {
                verticalUsed,
                horizontalUsed,
                isVerticallyScrollable,
                isHorizontallyScrollable,
            };
        });
        this.isVerticallyScrollable = computed(() => this.state().isVerticallyScrollable);
        this.isHorizontallyScrollable = computed(() => this.state().isHorizontallyScrollable);
        this.verticalUsed = computed(() => this.state().verticalUsed);
        this.horizontalUsed = computed(() => this.state().horizontalUsed);
        /** Scroll duration when the scroll track is clicked */
        this.trackScrollDuration = input(this.options.trackScrollDuration, {
            transform: numberAttribute
        });
        /**
         *  Sets the appearance of the scrollbar, there are 2 options:
         *
         * - `native` (default) scrollbar space will be reserved just like with native scrollbar.
         * - `compact` scrollbar doesn't reserve any space, they are placed over the viewport.
         */
        this.appearance = input(this.options.appearance);
        /**
         * Sets the position of each scrollbar, there are 4 options:
         *
         * - `native` (Default) Use the default position like in native scrollbar.
         * - `invertY` Inverts vertical scrollbar position
         * - `invertX` Inverts Horizontal scrollbar position
         * - `invertAll` Inverts both scrollbar positions
         */
        this.position = input(this.options.position);
        /** A class forwarded to the scrollbar track element */
        this.trackClass = input(this.options.trackClass);
        /** A class forwarded to the scrollbar thumb element */
        this.thumbClass = input(this.options.thumbClass);
        /** A class forwarded to the scrollbar button element */
        this.buttonClass = input(this.options.thumbClass);
        /** Steam that emits when scrollbar is initialized */
        this.afterInit = output();
        /** Steam that emits when scrollbar is updated */
        this.afterUpdate = output();
        let resizeSub$;
        let hasInitialized;
        effect((onCleanup) => {
            const disableSensor = this.disableSensor();
            const throttleDuration = this.sensorThrottleTime();
            const viewportInit = this.viewport.initialized();
            untracked(() => {
                if (viewportInit) {
                    // If resize sensor is disabled, update manually the first time
                    if (disableSensor) {
                        requestAnimationFrame(() => this.update(ScrollbarUpdateReason.AfterInit));
                    }
                    else {
                        // Observe size changes for viewport and content wrapper
                        this.zone.runOutsideAngular(() => {
                            resizeSub$ = getThrottledStream(combineLatest([
                                this.sharedResizeObserver.observe(this.viewport.nativeElement),
                                this.sharedResizeObserver.observe(this.viewport.contentWrapperElement)
                            ]), throttleDuration).subscribe(() => {
                                // After deep investigation, it appears that setting the dimension directly from the element properties
                                // is much faster than to set them from resize callback values
                                this.zone.run(() => {
                                    this.updateDimensions();
                                    if (hasInitialized) {
                                        this.afterUpdate.emit();
                                    }
                                    else {
                                        this.afterInit.emit();
                                    }
                                    hasInitialized = true;
                                });
                            });
                        });
                    }
                }
                onCleanup(() => resizeSub$?.unsubscribe());
            });
        });
    }
    /**
     * Manual update
     */
    update(reason) {
        this.updateDimensions();
        if (reason === ScrollbarUpdateReason.AfterInit) {
            this.afterInit.emit();
        }
        else {
            this.afterUpdate.emit();
        }
    }
    /**
     * Smooth scroll functions
     */
    scrollTo(options) {
        return this.smoothScroll.scrollTo(this.viewport.nativeElement, options);
    }
    /**
     * Scroll to element by reference or selector
     */
    scrollToElement(target, options) {
        return this.smoothScroll.scrollToElement(this.viewport.nativeElement, target, options);
    }
    updateDimensions() {
        this.viewportDimension.set({ width: this.viewport.offsetWidth, height: this.viewport.offsetHeight });
        this.contentDimension.set({ width: this.viewport.contentWidth, height: this.viewport.contentHeight });
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.11", ngImport: i0, type: NgScrollbarCore, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "17.1.0", version: "18.2.11", type: NgScrollbarCore, inputs: { orientation: { classPropertyName: "orientation", publicName: "orientation", isSignal: true, isRequired: false, transformFunction: null }, visibility: { classPropertyName: "visibility", publicName: "visibility", isSignal: true, isRequired: false, transformFunction: null }, buttons: { classPropertyName: "buttons", publicName: "buttons", isSignal: true, isRequired: false, transformFunction: null }, disableInteraction: { classPropertyName: "disableInteraction", publicName: "disableInteraction", isSignal: true, isRequired: false, transformFunction: null }, disableSensor: { classPropertyName: "disableSensor", publicName: "disableSensor", isSignal: true, isRequired: false, transformFunction: null }, sensorThrottleTime: { classPropertyName: "sensorThrottleTime", publicName: "sensorThrottleTime", isSignal: true, isRequired: false, transformFunction: null }, hoverOffset: { classPropertyName: "hoverOffset", publicName: "hoverOffset", isSignal: true, isRequired: false, transformFunction: null }, trackScrollDuration: { classPropertyName: "trackScrollDuration", publicName: "trackScrollDuration", isSignal: true, isRequired: false, transformFunction: null }, appearance: { classPropertyName: "appearance", publicName: "appearance", isSignal: true, isRequired: false, transformFunction: null }, position: { classPropertyName: "position", publicName: "position", isSignal: true, isRequired: false, transformFunction: null }, trackClass: { classPropertyName: "trackClass", publicName: "trackClass", isSignal: true, isRequired: false, transformFunction: null }, thumbClass: { classPropertyName: "thumbClass", publicName: "thumbClass", isSignal: true, isRequired: false, transformFunction: null }, buttonClass: { classPropertyName: "buttonClass", publicName: "buttonClass", isSignal: true, isRequired: false, transformFunction: null } }, outputs: { afterInit: "afterInit", afterUpdate: "afterUpdate" }, host: { properties: { "class.ng-scrollbar": "true", "attr.verticalUsed": "verticalUsed()", "attr.horizontalUsed": "horizontalUsed()", "attr.isVerticallyScrollable": "isVerticallyScrollable()", "attr.isHorizontallyScrollable": "isHorizontallyScrollable()", "attr.mobile": "isMobile", "attr.dir": "direction()", "attr.position": "position()", "attr.dragging": "dragging()", "attr.appearance": "appearance()", "attr.visibility": "visibility()", "attr.orientation": "orientation()", "attr.disableInteraction": "disableInteraction()", "style.--content-height": "contentDimension().height", "style.--content-width": "contentDimension().width", "style.--viewport-height": "viewportDimension().height", "style.--viewport-width": "viewportDimension().width" } }, providers: [
            { provide: NG_SCROLLBAR, useExisting: NgScrollbarCore }
        ], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.11", ngImport: i0, type: NgScrollbarCore, decorators: [{
            type: Directive,
            args: [{
                    host: {
                        '[class.ng-scrollbar]': 'true',
                        '[attr.verticalUsed]': 'verticalUsed()',
                        '[attr.horizontalUsed]': 'horizontalUsed()',
                        '[attr.isVerticallyScrollable]': 'isVerticallyScrollable()',
                        '[attr.isHorizontallyScrollable]': 'isHorizontallyScrollable()',
                        '[attr.mobile]': 'isMobile',
                        '[attr.dir]': 'direction()',
                        '[attr.position]': 'position()',
                        '[attr.dragging]': 'dragging()',
                        '[attr.appearance]': 'appearance()',
                        '[attr.visibility]': 'visibility()',
                        '[attr.orientation]': 'orientation()',
                        '[attr.disableInteraction]': 'disableInteraction()',
                        '[style.--content-height]': 'contentDimension().height',
                        '[style.--content-width]': 'contentDimension().width',
                        '[style.--viewport-height]': 'viewportDimension().height',
                        '[style.--viewport-width]': 'viewportDimension().width'
                    },
                    providers: [
                        { provide: NG_SCROLLBAR, useExisting: NgScrollbarCore }
                    ]
                }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctc2Nyb2xsYmFyLWNvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtc2Nyb2xsYmFyL3NyYy9saWIvbmctc2Nyb2xsYmFyLWNvcmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNMLFNBQVMsRUFDVCxNQUFNLEVBQ04sTUFBTSxFQUNOLE1BQU0sRUFDTixNQUFNLEVBQ04sUUFBUSxFQUNSLFNBQVMsRUFDVCxlQUFlLEVBQ2YsZ0JBQWdCLEVBQ2hCLEtBQUssRUFDTCxNQUFNLEVBRU4sVUFBVSxHQU1YLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNqRCxPQUFPLEVBQWEsY0FBYyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDOUQsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUFDdEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ3RELE9BQU8sRUFBRSxhQUFhLEVBQWdCLE1BQU0sTUFBTSxDQUFDO0FBQ25ELE9BQU8sRUFFTCxtQkFBbUIsRUFHcEIsTUFBTSw2QkFBNkIsQ0FBQztBQUVyQyxPQUFPLEVBQWdCLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDN0MsT0FBTyxFQUF1QyxrQkFBa0IsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pGLE9BQU8sRUFDTCxvQkFBb0IsRUFLcEIscUJBQXFCLEVBRXRCLE1BQU0sc0JBQXNCLENBQUM7O0FBaUM5QixNQUFNLE9BQWdCLGVBQWU7SUE0Sm5DO1FBMUpBLHFCQUFxQjtRQUNKLFlBQU8sR0FBdUIsTUFBTSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFM0QseUJBQW9CLEdBQXlCLE1BQU0sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FB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QXNCLEVBQUUsTUFBTTt3QkFDOUIscUJBQXFCLEVBQUUsZ0JBQWdCO3dCQUN2Qyx1QkFBdUIsRUFBRSxrQkFBa0I7d0JBQzNDLCtCQUErQixFQUFFLDBCQUEwQjt3QkFDM0QsaUNBQWlDLEVBQUUsNEJBQTRCO3dCQUMvRCxlQUFlLEVBQUUsVUFBVTt3QkFDM0IsWUFBWSxFQUFFLGFBQWE7d0JBQzNCLGlCQUFpQixFQUFFLFlBQVk7d0JBQy9CLGlCQUFpQixFQUFFLFlBQVk7d0JBQy9CLG1CQUFtQixFQUFFLGNBQWM7d0JBQ25DLG1CQUFtQixFQUFFLGNBQWM7d0JBQ25DLG9CQUFvQixFQUFFLGVBQWU7d0JBQ3JDLDJCQUEyQixFQUFFLHNCQUFzQjt3QkFDbkQsMEJBQTBCLEVBQUUsMkJBQTJCO3dCQUN2RCx5QkFBeUIsRUFBRSwwQkFBMEI7d0JBQ3JELDJCQUEyQixFQUFFLDRCQUE0Qjt3QkFDekQsMEJBQTBCLEVBQUUsMkJBQTJCO3FCQUN4RDtvQkFDRCxTQUFTLEVBQUU7d0JBQ1QsRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLFdBQVcsaUJBQWlCLEVBQUU7cUJBQ3hEO2lCQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBEaXJlY3RpdmUsXHJcbiAgaW5qZWN0LFxyXG4gIHNpZ25hbCxcclxuICBlZmZlY3QsXHJcbiAgb3V0cHV0LFxyXG4gIGNvbXB1dGVkLFxyXG4gIHVudHJhY2tlZCxcclxuICBudW1iZXJBdHRyaWJ1dGUsXHJcbiAgYm9vbGVhbkF0dHJpYnV0ZSxcclxuICBpbnB1dCxcclxuICBOZ1pvbmUsXHJcbiAgU2lnbmFsLFxyXG4gIEVsZW1lbnRSZWYsXHJcbiAgSW5wdXRTaWduYWwsXHJcbiAgV3JpdGFibGVTaWduYWwsXHJcbiAgT3V0cHV0RW1pdHRlclJlZixcclxuICBFZmZlY3RDbGVhbnVwUmVnaXN0ZXJGbixcclxuICBJbnB1dFNpZ25hbFdpdGhUcmFuc2Zvcm0sXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFBsYXRmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BsYXRmb3JtJztcclxuaW1wb3J0IHsgRGlyZWN0aW9uLCBEaXJlY3Rpb25hbGl0eSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9iaWRpJztcclxuaW1wb3J0IHsgU2hhcmVkUmVzaXplT2JzZXJ2ZXIgfSBmcm9tICdAYW5ndWxhci9jZGsvb2JzZXJ2ZXJzL3ByaXZhdGUnO1xyXG5pbXBvcnQgeyB0b1NpZ25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUvcnhqcy1pbnRlcm9wJztcclxuaW1wb3J0IHsgY29tYmluZUxhdGVzdCwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7XHJcbiAgU21vb3RoU2Nyb2xsRWxlbWVudCxcclxuICBTbW9vdGhTY3JvbGxNYW5hZ2VyLFxyXG4gIFNtb290aFNjcm9sbFRvRWxlbWVudE9wdGlvbnMsXHJcbiAgU21vb3RoU2Nyb2xsVG9PcHRpb25zXHJcbn0gZnJvbSAnbmd4LXNjcm9sbGJhci9zbW9vdGgtc2Nyb2xsJztcclxuaW1wb3J0IHsgU2Nyb2xsYmFycyB9IGZyb20gJy4vc2Nyb2xsYmFycy9zY3JvbGxiYXJzJztcclxuaW1wb3J0IHsgX05nU2Nyb2xsYmFyLCBOR19TQ1JPTExCQVIgfSBmcm9tICcuL3V0aWxzL3Njcm9sbGJhci1iYXNlJztcclxuaW1wb3J0IHsgVmlld3BvcnRBZGFwdGVyIH0gZnJvbSAnLi92aWV3cG9ydCc7XHJcbmltcG9ydCB7IEVsZW1lbnREaW1lbnNpb24sIFNjcm9sbGJhckRyYWdnaW5nLCBnZXRUaHJvdHRsZWRTdHJlYW0gfSBmcm9tICcuL3V0aWxzL2NvbW1vbic7XHJcbmltcG9ydCB7XHJcbiAgTkdfU0NST0xMQkFSX09QVElPTlMsXHJcbiAgTmdTY3JvbGxiYXJPcHRpb25zLFxyXG4gIFNjcm9sbGJhckFwcGVhcmFuY2UsXHJcbiAgU2Nyb2xsYmFyT3JpZW50YXRpb24sXHJcbiAgU2Nyb2xsYmFyUG9zaXRpb24sXHJcbiAgU2Nyb2xsYmFyVXBkYXRlUmVhc29uLFxyXG4gIFNjcm9sbGJhclZpc2liaWxpdHlcclxufSBmcm9tICcuL25nLXNjcm9sbGJhci5tb2RlbCc7XHJcblxyXG5pbnRlcmZhY2UgVmlld3BvcnRTdGF0ZSB7XHJcbiAgdmVydGljYWxVc2VkOiBib29sZWFuLFxyXG4gIGhvcml6b250YWxVc2VkOiBib29sZWFuLFxyXG4gIGlzVmVydGljYWxseVNjcm9sbGFibGU6IGJvb2xlYW4sXHJcbiAgaXNIb3Jpem9udGFsbHlTY3JvbGxhYmxlOiBib29sZWFuLFxyXG59XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBob3N0OiB7XHJcbiAgICAnW2NsYXNzLm5nLXNjcm9sbGJhcl0nOiAndHJ1ZScsXHJcbiAgICAnW2F0dHIudmVydGljYWxVc2VkXSc6ICd2ZXJ0aWNhbFVzZWQoKScsXHJcbiAgICAnW2F0dHIuaG9yaXpvbnRhbFVzZWRdJzogJ2hvcml6b250YWxVc2VkKCknLFxyXG4gICAgJ1thdHRyLmlzVmVydGljYWxseVNjcm9sbGFibGVdJzogJ2lzVmVydGljYWxseVNjcm9sbGFibGUoKScsXHJcbiAgICAnW2F0dHIuaXNIb3Jpem9udGFsbHlTY3JvbGxhYmxlXSc6ICdpc0hvcml6b250YWxseVNjcm9sbGFibGUoKScsXHJcbiAgICAnW2F0dHIubW9iaWxlXSc6ICdpc01vYmlsZScsXHJcbiAgICAnW2F0dHIuZGlyXSc6ICdkaXJlY3Rpb24oKScsXHJcbiAgICAnW2F0dHIucG9zaXRpb25dJzogJ3Bvc2l0aW9uKCknLFxyXG4gICAgJ1thdHRyLmRyYWdnaW5nXSc6ICdkcmFnZ2luZygpJyxcclxuICAgICdbYXR0ci5hcHBlYXJhbmNlXSc6ICdhcHBlYXJhbmNlKCknLFxyXG4gICAgJ1thdHRyLnZpc2liaWxpdHldJzogJ3Zpc2liaWxpdHkoKScsXHJcbiAgICAnW2F0dHIub3JpZW50YXRpb25dJzogJ29yaWVudGF0aW9uKCknLFxyXG4gICAgJ1thdHRyLmRpc2FibGVJbnRlcmFjdGlvbl0nOiAnZGlzYWJsZUludGVyYWN0aW9uKCknLFxyXG4gICAgJ1tzdHlsZS4tLWNvbnRlbnQtaGVpZ2h0XSc6ICdjb250ZW50RGltZW5zaW9uKCkuaGVpZ2h0JyxcclxuICAgICdbc3R5bGUuLS1jb250ZW50LXdpZHRoXSc6ICdjb250ZW50RGltZW5zaW9uKCkud2lkdGgnLFxyXG4gICAgJ1tzdHlsZS4tLXZpZXdwb3J0LWhlaWdodF0nOiAndmlld3BvcnREaW1lbnNpb24oKS5oZWlnaHQnLFxyXG4gICAgJ1tzdHlsZS4tLXZpZXdwb3J0LXdpZHRoXSc6ICd2aWV3cG9ydERpbWVuc2lvbigpLndpZHRoJ1xyXG4gIH0sXHJcbiAgcHJvdmlkZXJzOiBbXHJcbiAgICB7IHByb3ZpZGU6IE5HX1NDUk9MTEJBUiwgdXNlRXhpc3Rpbmc6IE5nU2Nyb2xsYmFyQ29yZSB9XHJcbiAgXVxyXG59KVxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgTmdTY3JvbGxiYXJDb3JlIGltcGxlbWVudHMgX05nU2Nyb2xsYmFyIHtcclxuXHJcbiAgLyoqIEdsb2JhbCBvcHRpb25zICovXHJcbiAgcHJpdmF0ZSByZWFkb25seSBvcHRpb25zOiBOZ1Njcm9sbGJhck9wdGlvbnMgPSBpbmplY3QoTkdfU0NST0xMQkFSX09QVElPTlMpO1xyXG5cclxuICBwcml2YXRlIHJlYWRvbmx5IHNoYXJlZFJlc2l6ZU9ic2VydmVyOiBTaGFyZWRSZXNpemVPYnNlcnZlciA9IGluamVjdChTaGFyZWRSZXNpemVPYnNlcnZlcik7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgem9uZTogTmdab25lID0gaW5qZWN0KE5nWm9uZSk7XHJcblxyXG4gIHByaXZhdGUgcmVhZG9ubHkgcGxhdGZvcm06IFBsYXRmb3JtID0gaW5qZWN0KFBsYXRmb3JtKTtcclxuXHJcbiAgLyoqIEEgZmxhZyB0aGF0IGluZGljYXRlcyBpZiB0aGUgcGxhdGZvcm0gaXMgbW9iaWxlICovXHJcbiAgcmVhZG9ubHkgaXNNb2JpbGU6IGJvb2xlYW4gPSB0aGlzLnBsYXRmb3JtLklPUyB8fCB0aGlzLnBsYXRmb3JtLkFORFJPSUQ7XHJcblxyXG4gIHJlYWRvbmx5IGRpcjogRGlyZWN0aW9uYWxpdHkgPSBpbmplY3QoRGlyZWN0aW9uYWxpdHkpO1xyXG5cclxuICByZWFkb25seSBzbW9vdGhTY3JvbGw6IFNtb290aFNjcm9sbE1hbmFnZXIgPSBpbmplY3QoU21vb3RoU2Nyb2xsTWFuYWdlcik7XHJcblxyXG4gIC8qKiBWaWV3cG9ydCBhZGFwdGVyIGluc3RhbmNlICovXHJcbiAgcmVhZG9ubHkgdmlld3BvcnQ6IFZpZXdwb3J0QWRhcHRlciA9IGluamVjdChWaWV3cG9ydEFkYXB0ZXIsIHsgc2VsZjogdHJ1ZSB9KTtcclxuXHJcbiAgcmVhZG9ubHkgbmF0aXZlRWxlbWVudDogSFRNTEVsZW1lbnQgPSBpbmplY3QoRWxlbWVudFJlZjxIVE1MRWxlbWVudD4pLm5hdGl2ZUVsZW1lbnQ7XHJcblxyXG4gIC8qKlxyXG4gICAqIEluZGljYXRlcyBpZiB0aGUgZGlyZWN0aW9uIGlzICdsdHInIG9yICdydGwnXHJcbiAgICovXHJcbiAgZGlyZWN0aW9uOiBTaWduYWw8RGlyZWN0aW9uPiA9IHRvU2lnbmFsPERpcmVjdGlvbiwgRGlyZWN0aW9uPih0aGlzLmRpci5jaGFuZ2UsIHsgaW5pdGlhbFZhbHVlOiB0aGlzLmRpci52YWx1ZSB9KTtcclxuXHJcbiAgLyoqXHJcbiAgICogSW5kaWNhdGVzIHdoZW4gc2Nyb2xsYmFyIHRodW1iIGlzIGJlaW5nIGRyYWdnZWRcclxuICAgKi9cclxuICBkcmFnZ2luZzogV3JpdGFibGVTaWduYWw8U2Nyb2xsYmFyRHJhZ2dpbmc+ID0gc2lnbmFsKCdub25lJyk7XHJcblxyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIHN1cHBvcnRlZCBzY3JvbGwgdHJhY2sgb2YgdGhlIHZpZXdwb3J0LCB0aGVyZSBhcmUgMyBvcHRpb25zOlxyXG4gICAqXHJcbiAgICogLSBgdmVydGljYWxgIFVzZSBib3RoIHZlcnRpY2FsIGFuZCBob3Jpem9udGFsIHNjcm9sbGJhclxyXG4gICAqIC0gYGhvcml6b250YWxgIFVzZSBib3RoIHZlcnRpY2FsIGFuZCBob3Jpem9udGFsIHNjcm9sbGJhclxyXG4gICAqIC0gYGF1dG9gIFVzZSBib3RoIHZlcnRpY2FsIGFuZCBob3Jpem9udGFsIHNjcm9sbGJhclxyXG4gICAqL1xyXG4gIG9yaWVudGF0aW9uOiBJbnB1dFNpZ25hbDxTY3JvbGxiYXJPcmllbnRhdGlvbj4gPSBpbnB1dDxTY3JvbGxiYXJPcmllbnRhdGlvbj4odGhpcy5vcHRpb25zLm9yaWVudGF0aW9uKTtcclxuXHJcbiAgLyoqXHJcbiAgICogV2hlbiB0byBzaG93IHRoZSBzY3JvbGxiYXIsIGFuZCB0aGVyZSBhcmUgMyBvcHRpb25zOlxyXG4gICAqXHJcbiAgICogLSBgbmF0aXZlYCAoZGVmYXVsdCkgU2Nyb2xsYmFyIHdpbGwgYmUgdmlzaWJsZSB3aGVuIHZpZXdwb3J0IGlzIHNjcm9sbGFibGUgbGlrZSB3aXRoIG5hdGl2ZSBzY3JvbGxiYXJcclxuICAgKiAtIGBob3ZlcmAgU2Nyb2xsYmFycyBhcmUgaGlkZGVuIGJ5IGRlZmF1bHQsIG9ubHkgdmlzaWJsZSBvbiBzY3JvbGxpbmcgb3IgaG92ZXJpbmdcclxuICAgKiAtIGBhbHdheXNgIFNjcm9sbGJhcnMgYXJlIGFsd2F5cyBzaG93biBldmVuIGlmIHRoZSB2aWV3cG9ydCBpcyBub3Qgc2Nyb2xsYWJsZVxyXG4gICAqL1xyXG4gIHZpc2liaWxpdHk6IElucHV0U2lnbmFsPFNjcm9sbGJhclZpc2liaWxpdHk+ID0gaW5wdXQ8U2Nyb2xsYmFyVmlzaWJpbGl0eT4odGhpcy5vcHRpb25zLnZpc2liaWxpdHkpO1xyXG5cclxuICAvKiogU2hvdyBzY3JvbGxiYXIgYnV0dG9ucyAqL1xyXG4gIGJ1dHRvbnM6IElucHV0U2lnbmFsV2l0aFRyYW5zZm9ybTxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPiA9IGlucHV0PGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+KHRoaXMub3B0aW9ucy5idXR0b25zLCB7XHJcbiAgICB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGVcclxuICB9KTtcclxuXHJcbiAgLyoqIERpc2FibGVzIHNjcm9sbGJhciBpbnRlcmFjdGlvbiBsaWtlIGRyYWdnaW5nIHRodW1iIGFuZCBqdW1waW5nIGJ5IHRyYWNrIGNsaWNrICovXHJcbiAgZGlzYWJsZUludGVyYWN0aW9uOiBJbnB1dFNpZ25hbFdpdGhUcmFuc2Zvcm08Ym9vbGVhbiwgc3RyaW5nIHwgYm9vbGVhbj4gPSBpbnB1dDxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPih0aGlzLm9wdGlvbnMuZGlzYWJsZUludGVyYWN0aW9uLCB7XHJcbiAgICB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGVcclxuICB9KTtcclxuXHJcbiAgLyoqIFdoZXRoZXIgUmVzaXplT2JzZXJ2ZXIgaXMgZGlzYWJsZWQgKi9cclxuICBkaXNhYmxlU2Vuc29yOiBJbnB1dFNpZ25hbFdpdGhUcmFuc2Zvcm08Ym9vbGVhbiwgc3RyaW5nIHwgYm9vbGVhbj4gPSBpbnB1dDxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPih0aGlzLm9wdGlvbnMuZGlzYWJsZVNlbnNvciwge1xyXG4gICAgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlXHJcbiAgfSk7XHJcblxyXG4gIC8qKiBUaHJvdHRsZSBpbnRlcnZhbCBmb3IgZGV0ZWN0aW5nIGNoYW5nZXMgdmlhIFJlc2l6ZU9ic2VydmVyICovXHJcbiAgc2Vuc29yVGhyb3R0bGVUaW1lOiBJbnB1dFNpZ25hbDxudW1iZXI+ID0gaW5wdXQ8bnVtYmVyLCBudW1iZXI+KHRoaXMub3B0aW9ucy5zZW5zb3JUaHJvdHRsZVRpbWUsIHtcclxuICAgIHRyYW5zZm9ybTogbnVtYmVyQXR0cmlidXRlXHJcbiAgfSk7XHJcblxyXG4gIC8qKiBBIGZsYWcgdXNlZCB0byBhY3RpdmF0ZSBob3ZlciBlZmZlY3Qgb24gdGhlIG9mZnNldCBhcmVhIGFyb3VuZCB0aGUgc2Nyb2xsYmFyICovXHJcbiAgaG92ZXJPZmZzZXQ6IElucHV0U2lnbmFsV2l0aFRyYW5zZm9ybTxib29sZWFuLCBzdHJpbmcgfCBib29sZWFuPiA9IGlucHV0PGJvb2xlYW4sIHN0cmluZyB8IGJvb2xlYW4+KHRoaXMub3B0aW9ucy5ob3Zlck9mZnNldCwge1xyXG4gICAgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlXHJcbiAgfSk7XHJcblxyXG4gIC8qKiBWaWV3cG9ydCBkaW1lbnNpb24gKi9cclxuICB2aWV3cG9ydERpbWVuc2lvbjogV3JpdGFibGVTaWduYWw8RWxlbWVudERpbWVuc2lvbj4gPSBzaWduYWw8RWxlbWVudERpbWVuc2lvbj4oeyB3aWR0aDogMCwgaGVpZ2h0OiAwIH0pO1xyXG5cclxuICAvKiogQ29udGVudCBkaW1lbnNpb24gKi9cclxuICBjb250ZW50RGltZW5zaW9uOiBXcml0YWJsZVNpZ25hbDxFbGVtZW50RGltZW5zaW9uPiA9IHNpZ25hbDxFbGVtZW50RGltZW5zaW9uPih7IHdpZHRoOiAwLCBoZWlnaHQ6IDAgfSk7XHJcblxyXG4gIHByaXZhdGUgc3RhdGU6IFNpZ25hbDxWaWV3cG9ydFN0YXRlPiA9IGNvbXB1dGVkKCgpID0+IHtcclxuICAgIGxldCB2ZXJ0aWNhbFVzZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGxldCBob3Jpem9udGFsVXNlZDogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgbGV0IGlzVmVydGljYWxseVNjcm9sbGFibGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICAgIGxldCBpc0hvcml6b250YWxseVNjcm9sbGFibGU6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgICBjb25zdCBvcmllbnRhdGlvbjogU2Nyb2xsYmFyT3JpZW50YXRpb24gPSB0aGlzLm9yaWVudGF0aW9uKCk7XHJcbiAgICBjb25zdCB2aXNpYmlsaXR5OiBTY3JvbGxiYXJWaXNpYmlsaXR5ID0gdGhpcy52aXNpYmlsaXR5KCk7XHJcblxyXG4gICAgY29uc3Qgdmlld3BvcnREaW1lbnNpb25zOiBFbGVtZW50RGltZW5zaW9uID0gdGhpcy52aWV3cG9ydERpbWVuc2lvbigpO1xyXG4gICAgY29uc3QgY29udGVudERpbWVuc2lvbnM6IEVsZW1lbnREaW1lbnNpb24gPSB0aGlzLmNvbnRlbnREaW1lbnNpb24oKTtcclxuXHJcbiAgICAvLyBDaGVjayBpZiB2ZXJ0aWNhbCBzY3JvbGxiYXIgc2hvdWxkIGJlIGRpc3BsYXllZFxyXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSAnYXV0bycgfHwgb3JpZW50YXRpb24gPT09ICd2ZXJ0aWNhbCcpIHtcclxuICAgICAgaXNWZXJ0aWNhbGx5U2Nyb2xsYWJsZSA9IGNvbnRlbnREaW1lbnNpb25zLmhlaWdodCA+IHZpZXdwb3J0RGltZW5zaW9ucy5oZWlnaHQ7XHJcbiAgICAgIHZlcnRpY2FsVXNlZCA9IHZpc2liaWxpdHkgPT09ICd2aXNpYmxlJyB8fCBpc1ZlcnRpY2FsbHlTY3JvbGxhYmxlO1xyXG4gICAgfVxyXG4gICAgLy8gQ2hlY2sgaWYgaG9yaXpvbnRhbCBzY3JvbGxiYXIgc2hvdWxkIGJlIGRpc3BsYXllZFxyXG4gICAgaWYgKG9yaWVudGF0aW9uID09PSAnYXV0bycgfHwgb3JpZW50YXRpb24gPT09ICdob3Jpem9udGFsJykge1xyXG4gICAgICBpc0hvcml6b250YWxseVNjcm9sbGFibGUgPSBjb250ZW50RGltZW5zaW9ucy53aWR0aCA+IHZpZXdwb3J0RGltZW5zaW9ucy53aWR0aDtcclxuICAgICAgaG9yaXpvbnRhbFVzZWQgPSB2aXNpYmlsaXR5ID09PSAndmlzaWJsZScgfHwgaXNIb3Jpem9udGFsbHlTY3JvbGxhYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgIHZlcnRpY2FsVXNlZCxcclxuICAgICAgaG9yaXpvbnRhbFVzZWQsXHJcbiAgICAgIGlzVmVydGljYWxseVNjcm9sbGFibGUsXHJcbiAgICAgIGlzSG9yaXpvbnRhbGx5U2Nyb2xsYWJsZSxcclxuICAgIH07XHJcbiAgfSk7XHJcblxyXG4gIGlzVmVydGljYWxseVNjcm9sbGFibGU6IFNpZ25hbDxib29sZWFuPiA9IGNvbXB1dGVkKCgpID0+IHRoaXMuc3RhdGUoKS5pc1ZlcnRpY2FsbHlTY3JvbGxhYmxlKTtcclxuICBpc0hvcml6b250YWxseVNjcm9sbGFibGU6IFNpZ25hbDxib29sZWFuPiA9IGNvbXB1dGVkKCgpID0+IHRoaXMuc3RhdGUoKS5pc0hvcml6b250YWxseVNjcm9sbGFibGUpO1xyXG4gIHZlcnRpY2FsVXNlZDogU2lnbmFsPGJvb2xlYW4+ID0gY29tcHV0ZWQoKCkgPT4gdGhpcy5zdGF0ZSgpLnZlcnRpY2FsVXNlZCk7XHJcbiAgaG9yaXpvbnRhbFVzZWQ6IFNpZ25hbDxib29sZWFuPiA9IGNvbXB1dGVkKCgpID0+IHRoaXMuc3RhdGUoKS5ob3Jpem9udGFsVXNlZCk7XHJcblxyXG4gIC8qKiBTY3JvbGwgZHVyYXRpb24gd2hlbiB0aGUgc2Nyb2xsIHRyYWNrIGlzIGNsaWNrZWQgKi9cclxuICB0cmFja1Njcm9sbER1cmF0aW9uOiBJbnB1dFNpZ25hbFdpdGhUcmFuc2Zvcm08bnVtYmVyLCBzdHJpbmcgfCBudW1iZXI+ID0gaW5wdXQ8bnVtYmVyLCBzdHJpbmcgfCBudW1iZXI+KHRoaXMub3B0aW9ucy50cmFja1Njcm9sbER1cmF0aW9uLCB7XHJcbiAgICB0cmFuc2Zvcm06IG51bWJlckF0dHJpYnV0ZVxyXG4gIH0pO1xyXG5cclxuICAvKipcclxuICAgKiAgU2V0cyB0aGUgYXBwZWFyYW5jZSBvZiB0aGUgc2Nyb2xsYmFyLCB0aGVyZSBhcmUgMiBvcHRpb25zOlxyXG4gICAqXHJcbiAgICogLSBgbmF0aXZlYCAoZGVmYXVsdCkgc2Nyb2xsYmFyIHNwYWNlIHdpbGwgYmUgcmVzZXJ2ZWQganVzdCBsaWtlIHdpdGggbmF0aXZlIHNjcm9sbGJhci5cclxuICAgKiAtIGBjb21wYWN0YCBzY3JvbGxiYXIgZG9lc24ndCByZXNlcnZlIGFueSBzcGFjZSwgdGhleSBhcmUgcGxhY2VkIG92ZXIgdGhlIHZpZXdwb3J0LlxyXG4gICAqL1xyXG4gIGFwcGVhcmFuY2U6IElucHV0U2lnbmFsPFNjcm9sbGJhckFwcGVhcmFuY2U+ID0gaW5wdXQ8U2Nyb2xsYmFyQXBwZWFyYW5jZT4odGhpcy5vcHRpb25zLmFwcGVhcmFuY2UpO1xyXG4gIC8qKlxyXG4gICAqIFNldHMgdGhlIHBvc2l0aW9uIG9mIGVhY2ggc2Nyb2xsYmFyLCB0aGVyZSBhcmUgNCBvcHRpb25zOlxyXG4gICAqXHJcbiAgICogLSBgbmF0aXZlYCAoRGVmYXVsdCkgVXNlIHRoZSBkZWZhdWx0IHBvc2l0aW9uIGxpa2UgaW4gbmF0aXZlIHNjcm9sbGJhci5cclxuICAgKiAtIGBpbnZlcnRZYCBJbnZlcnRzIHZlcnRpY2FsIHNjcm9sbGJhciBwb3NpdGlvblxyXG4gICAqIC0gYGludmVydFhgIEludmVydHMgSG9yaXpvbnRhbCBzY3JvbGxiYXIgcG9zaXRpb25cclxuICAgKiAtIGBpbnZlcnRBbGxgIEludmVydHMgYm90aCBzY3JvbGxiYXIgcG9zaXRpb25zXHJcbiAgICovXHJcbiAgcG9zaXRpb246IElucHV0U2lnbmFsPFNjcm9sbGJhclBvc2l0aW9uPiA9IGlucHV0PFNjcm9sbGJhclBvc2l0aW9uPih0aGlzLm9wdGlvbnMucG9zaXRpb24pO1xyXG5cclxuICAvKiogQSBjbGFzcyBmb3J3YXJkZWQgdG8gdGhlIHNjcm9sbGJhciB0cmFjayBlbGVtZW50ICovXHJcbiAgdHJhY2tDbGFzczogSW5wdXRTaWduYWw8c3RyaW5nPiA9IGlucHV0PHN0cmluZz4odGhpcy5vcHRpb25zLnRyYWNrQ2xhc3MpO1xyXG4gIC8qKiBBIGNsYXNzIGZvcndhcmRlZCB0byB0aGUgc2Nyb2xsYmFyIHRodW1iIGVsZW1lbnQgKi9cclxuICB0aHVtYkNsYXNzOiBJbnB1dFNpZ25hbDxzdHJpbmc+ID0gaW5wdXQ8c3RyaW5nPih0aGlzLm9wdGlvbnMudGh1bWJDbGFzcyk7XHJcbiAgLyoqIEEgY2xhc3MgZm9yd2FyZGVkIHRvIHRoZSBzY3JvbGxiYXIgYnV0dG9uIGVsZW1lbnQgKi9cclxuICBidXR0b25DbGFzczogSW5wdXRTaWduYWw8c3RyaW5nPiA9IGlucHV0PHN0cmluZz4odGhpcy5vcHRpb25zLnRodW1iQ2xhc3MpO1xyXG5cclxuICAvKiogU3RlYW0gdGhhdCBlbWl0cyB3aGVuIHNjcm9sbGJhciBpcyBpbml0aWFsaXplZCAqL1xyXG4gIGFmdGVySW5pdDogT3V0cHV0RW1pdHRlclJlZjx2b2lkPiA9IG91dHB1dDx2b2lkPigpO1xyXG5cclxuICAvKiogU3RlYW0gdGhhdCBlbWl0cyB3aGVuIHNjcm9sbGJhciBpcyB1cGRhdGVkICovXHJcbiAgYWZ0ZXJVcGRhdGU6IE91dHB1dEVtaXR0ZXJSZWY8dm9pZD4gPSBvdXRwdXQ8dm9pZD4oKTtcclxuXHJcbiAgLyoqIFRoZSBzY3JvbGxiYXJzIGNvbXBvbmVudCBpbnN0YW5jZSB1c2VkIGZvciB0ZXN0aW5nIHB1cnBvc2UgKi9cclxuICBhYnN0cmFjdCBfc2Nyb2xsYmFyczogU2lnbmFsPFNjcm9sbGJhcnM+O1xyXG5cclxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoKSB7XHJcbiAgICBsZXQgcmVzaXplU3ViJDogU3Vic2NyaXB0aW9uO1xyXG4gICAgbGV0IGhhc0luaXRpYWxpemVkOiBib29sZWFuO1xyXG5cclxuICAgIGVmZmVjdCgob25DbGVhbnVwOiBFZmZlY3RDbGVhbnVwUmVnaXN0ZXJGbikgPT4ge1xyXG4gICAgICBjb25zdCBkaXNhYmxlU2Vuc29yOiBib29sZWFuID0gdGhpcy5kaXNhYmxlU2Vuc29yKCk7XHJcbiAgICAgIGNvbnN0IHRocm90dGxlRHVyYXRpb246IG51bWJlciA9IHRoaXMuc2Vuc29yVGhyb3R0bGVUaW1lKCk7XHJcbiAgICAgIGNvbnN0IHZpZXdwb3J0SW5pdDogYm9vbGVhbiA9IHRoaXMudmlld3BvcnQuaW5pdGlhbGl6ZWQoKTtcclxuXHJcbiAgICAgIHVudHJhY2tlZCgoKSA9PiB7XHJcbiAgICAgICAgaWYgKHZpZXdwb3J0SW5pdCkge1xyXG4gICAgICAgICAgLy8gSWYgcmVzaXplIHNlbnNvciBpcyBkaXNhYmxlZCwgdXBkYXRlIG1hbnVhbGx5IHRoZSBmaXJzdCB0aW1lXHJcbiAgICAgICAgICBpZiAoZGlzYWJsZVNlbnNvcikge1xyXG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gdGhpcy51cGRhdGUoU2Nyb2xsYmFyVXBkYXRlUmVhc29uLkFmdGVySW5pdCkpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgLy8gT2JzZXJ2ZSBzaXplIGNoYW5nZXMgZm9yIHZpZXdwb3J0IGFuZCBjb250ZW50IHdyYXBwZXJcclxuICAgICAgICAgICAgdGhpcy56b25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcclxuICAgICAgICAgICAgICByZXNpemVTdWIkID0gZ2V0VGhyb3R0bGVkU3RyZWFtKFxyXG4gICAgICAgICAgICAgICAgY29tYmluZUxhdGVzdChbXHJcbiAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcmVkUmVzaXplT2JzZXJ2ZXIub2JzZXJ2ZSh0aGlzLnZpZXdwb3J0Lm5hdGl2ZUVsZW1lbnQpLFxyXG4gICAgICAgICAgICAgICAgICB0aGlzLnNoYXJlZFJlc2l6ZU9ic2VydmVyLm9ic2VydmUodGhpcy52aWV3cG9ydC5jb250ZW50V3JhcHBlckVsZW1lbnQpXHJcbiAgICAgICAgICAgICAgICBdKSxcclxuICAgICAgICAgICAgICAgIHRocm90dGxlRHVyYXRpb25cclxuICAgICAgICAgICAgICApLnN1YnNjcmliZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBBZnRlciBkZWVwIGludmVzdGlnYXRpb24sIGl0IGFwcGVhcnMgdGhhdCBzZXR0aW5nIHRoZSBkaW1lbnNpb24gZGlyZWN0bHkgZnJvbSB0aGUgZWxlbWVudCBwcm9wZXJ0aWVzXHJcbiAgICAgICAgICAgICAgICAvLyBpcyBtdWNoIGZhc3RlciB0aGFuIHRvIHNldCB0aGVtIGZyb20gcmVzaXplIGNhbGxiYWNrIHZhbHVlc1xyXG4gICAgICAgICAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGltZW5zaW9ucygpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgaWYgKGhhc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlclVwZGF0ZS5lbWl0KCk7XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlckluaXQuZW1pdCgpO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIGhhc0luaXRpYWxpemVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIG9uQ2xlYW51cCgoKSA9PiByZXNpemVTdWIkPy51bnN1YnNjcmliZSgpKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hbnVhbCB1cGRhdGVcclxuICAgKi9cclxuICB1cGRhdGUocmVhc29uPzogU2Nyb2xsYmFyVXBkYXRlUmVhc29uKTogdm9pZCB7XHJcbiAgICB0aGlzLnVwZGF0ZURpbWVuc2lvbnMoKTtcclxuXHJcbiAgICBpZiAocmVhc29uID09PSBTY3JvbGxiYXJVcGRhdGVSZWFzb24uQWZ0ZXJJbml0KSB7XHJcbiAgICAgIHRoaXMuYWZ0ZXJJbml0LmVtaXQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuYWZ0ZXJVcGRhdGUuZW1pdCgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU21vb3RoIHNjcm9sbCBmdW5jdGlvbnNcclxuICAgKi9cclxuICBzY3JvbGxUbyhvcHRpb25zOiBTbW9vdGhTY3JvbGxUb09wdGlvbnMpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnNtb290aFNjcm9sbC5zY3JvbGxUbyh0aGlzLnZpZXdwb3J0Lm5hdGl2ZUVsZW1lbnQsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2Nyb2xsIHRvIGVsZW1lbnQgYnkgcmVmZXJlbmNlIG9yIHNlbGVjdG9yXHJcbiAgICovXHJcbiAgc2Nyb2xsVG9FbGVtZW50KHRhcmdldDogU21vb3RoU2Nyb2xsRWxlbWVudCwgb3B0aW9ucz86IFNtb290aFNjcm9sbFRvRWxlbWVudE9wdGlvbnMpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHJldHVybiB0aGlzLnNtb290aFNjcm9sbC5zY3JvbGxUb0VsZW1lbnQodGhpcy52aWV3cG9ydC5uYXRpdmVFbGVtZW50LCB0YXJnZXQsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSB1cGRhdGVEaW1lbnNpb25zKCk6IHZvaWQge1xyXG4gICAgdGhpcy52aWV3cG9ydERpbWVuc2lvbi5zZXQoeyB3aWR0aDogdGhpcy52aWV3cG9ydC5vZmZzZXRXaWR0aCwgaGVpZ2h0OiB0aGlzLnZpZXdwb3J0Lm9mZnNldEhlaWdodCB9KTtcclxuICAgIHRoaXMuY29udGVudERpbWVuc2lvbi5zZXQoeyB3aWR0aDogdGhpcy52aWV3cG9ydC5jb250ZW50V2lkdGgsIGhlaWdodDogdGhpcy52aWV3cG9ydC5jb250ZW50SGVpZ2h0IH0pO1xyXG4gIH1cclxufVxyXG4iXX0=